
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taskmaster</title>
    <style>
             header {
    background: linear-gradient(to right, #002aff, #b607cddc);
    color: #fff;
    padding: 0 rem;
    display: flex;
    justify-content: flex-end;
    align-items: center;
    height: 0.5%; /* Ajuste de la altura para que no sea demasiado pequeña */
    width: 100%; /* Cambio a 100% para que se extienda a lo largo de la pantalla */
}









    .logo {
    width: 25%;
    margin-right:64%;
}

/*---------------------------------PANEL CHECK LIST------------------------------------------*/


        #checklistPanel {
            width: 100%;
            height: 50%; /* Ajusta la altura según tus necesidades */
            padding: 10px; /* Ajusta el padding según tus necesidades */
            box-sizing: border-box; /* Asegura que el padding no afecte el tamaño total */
            overflow: auto; /* Agregado para habilitar las barras de desplazamiento si es necesario */
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #0ddefa;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        #addItemContainer {
            margin-bottom: 10px;
        }

        ul {
            list-style-type: none;
            padding: 0;
            margin: 0; /* Nuevo: Elimina el margen predeterminado de la lista */
        }

        li {
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #eee;
            padding: 8px;
            cursor: pointer;
            transition: background-color 0.3s, box-shadow 0.3s; /* Agregado para transiciones */
        }

        li:hover {
            background-color: #f9f9f9; /* Color de fondo al pasar el mouse */
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); /* Sutil sombra al pasar el mouse */
        }

        .completed {
            text-decoration: line-through;
            color: #888;
        }

        .deleteButton {
            background-color: #ff5c5c;
            color: white;
            border: none;
            padding: 5px;
            cursor: pointer;
            transition: background-color 0.3s; /* Agregado para transición de color */
        }

        .deleteButton:hover {
            background-color: #d32f2f; /* Cambio de color al pasar el mouse */
        }

        .clickable {
            cursor: pointer;
            transition: color 0.3s; /* Agregado para transición de color */
        }

        .clickable:hover {
            color: #2196f3; /* Cambio de color al pasar el mouse */
        }

/*---------------------------------PANEL CHECK LIST------------------------------------------*/

.Recompensa, .usuarioPerfil {
    background-size: contain;
    background-repeat: no-repeat;
    width: 100%; /* Ajusta el tamaño de la imagen según tus necesidades */
    height: autopx; /* Ajusta el tamaño de la imagen según tus necesidades */
    display: inline-block;
    cursor: pointer;
    text-indent: -9999px;
    border: none;
    background-color: transparent;
    padding: 2%;
 
}

.Configuracion, .Seccion1, .Seccion2 {
    background-size: contain;
    background-repeat: no-repeat;
    width: 50px; /* Ajusta el tamaño de la imagen según tus necesidades */
    height: 50px; /* Ajusta el tamaño de la imagen según tus necesidades */
    display: inline-block;
    cursor: pointer;
    text-indent: -9999px;
    border: none;
    background-color: transparent;
    padding: 0;
 
}
.editar_texto,.eliminarSeccion{
    background-size: contain;
    background-repeat: no-repeat;
    width: 40px; /* Ajusta el tamaño de la imagen según tus necesidades */
    height: 40px; /* Ajusta el tamaño de la imagen según tus necesidades */
    display: inline-block;
    cursor: pointer;
    text-indent: -9999px;
    border: none;
    background-color: transparent;
    padding: 0;
   /* margin-left: 5px;*/



}
.Campana, .Agregar, .AgregarAmigo {
    background-size: contain;
    background-repeat: no-repeat;
    width: 50px; /* Ancho de la imagen en píxeles */
    height: 50px; /* Alto de la imagen en píxeles */
    display: inline-block;
    cursor: pointer;
    text-indent: -9999px;
    border: none;
    background-color: transparent;
    padding: 0;
}

.Campana {
    background-image: url('Images/Campana_notificacion.png'); /* Asegúrate de que la ruta de la imagen sea correcta */
    background-size: contain;
    background-repeat: no-repeat;
    width: 50px; /* Ancho de la imagen en píxeles */
    height: 50px; /* Alto de la imagen en píxeles */
    display: inline-block;
    cursor: pointer;
    text-indent: -9999px;
    border: none;
    background-color: transparent;
    padding: 0;
}
.AgregarSeccion_Mas_Left_Panel {
    background-image: url('Images/+Agregar\ Seccion.png'); /* Asegúrate de que la ruta de la imagen sea correcta */
    background-size: contain;
    background-repeat: no-repeat;
    width: 150px; /* Ancho de la imagen en píxeles */
    height: 40px; /* Alto de la imagen en píxeles */
    
    cursor: pointer;
    text-indent: -9999px;
    border: none;
    background-color: transparent;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    margin-top: 230%;
}
.Agregar {
    background-image: url('images/Agregar.png');
}
.AgregarAmigo {
    background-image: url('images/AgregarAmigo.png');
    order: 2; /* Esto asegura que el enlace esté a la derecha si no lo está */
    
}

.espacio{
margin-left: 60%


}
.espacio2{
margin-left: 55%


}
.Configuracion {
    background-image: url('images/Barrita_herramienta.png');
}
.editar_texto {
    background-image: url('images/editar_texto.png');
}
.eliminarSeccion {
    background-image: url('images/basura.png');
}
.Seccion1 {
    background-image: url('images/secciones.png    ');
}

.Seccion2 {
    background-image: url('images/secciones2.png');
}
.usuarioPerfil {
    background-image: url('images/Perfil_Imagen.png');
}
.Recompensa {
    background-image: url('images/Recompensa.png');
}
        body {
            font-family: Arial, sans-serif;
            background-color: #EAEAEA;
            margin: 0;
            padding: 0;
        }



        
        #container {
            display: flex;
            width: 100vw;
            height: 88vh;
        }
        #left-panel {
            flex: 1;
            background-color: #c4c4c4;
           
            padding-right: 1%;
            border-right: 1% solid #ccc;
            flex-direction: column;
            text-align: left;
            
            height: auto;

        }
        #middle-panel {
            flex: 7;
            background-color: #fff;
            padding: 0%;
            border-right: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            width: 100%;
            height: auto;
        }

        #middle-panelSecundario {
            flex: 7;
            background-color: #fff;
            padding: 0%;
            border-right: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            width: 100%;
            height: auto;
            display: none;
        }

        #middle-panel2 {
            flex: 7;
            background-color: #fff;
            padding: 0%;
            border-right: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            width: 100%;
            height: auto;
            
        }
        #middle-panelProgramacionWeb {
            background: #c4c4c4;
      color: #fff;
      padding: 1rem;
      display: flex;
      justify-content: flex-end;
    align-items: center;
      height: 1.5%;
      width: 100%;
        }
        .textoPanelProgramacion{
            background: #c4c4c4;
            color: #000000;
            display: flex;
            justify-content: flex-end; /* Corregido de 'space between' a 'space-between' */
    align-items: center;
    margin-right: 15%;



        
}
.textoPanelProgramacion2{
            background: #c4c4c4;
            color: #000000;
            display: flex;
            justify-content: flex-end; /* Corregido de 'space between' a 'space-between' */
    align-items: center;
    margin-right: 15%;



        }
        .TextoListaAmigos{
            color: #ffffff;
            margin-right: 25%;
            



        }
        #right-panel {
            flex: 2;
            background-color: #BBE7FF;
            padding: 0px;
            padding-right:0px ;
            
        }
        #right-panelRecordatorios{
  background: linear-gradient(to right, #002aff, #b607cddc);
  color: #fff;
  
  padding: 1rem; /* Ajusta el padding según sea necesario */
  display: flex;
  justify-content: flex-end;
  align-items: center;
  height:  1.5%; /* Ajustado a 50px para que tenga espacio suficiente para contenido */
  width: calc(100% - 1rem); /* Usando 100% menos el padding para que se extienda a todo el ancho */
  width: auto;
  margin-right: 0;

    
}


#right-panelListaAmigos {
    background: linear-gradient(to right, #002aff, #b607cddc);
  color: #fff;
  padding: 1rem; /* Ajusta el padding según sea necesario */
  display: flex;
  justify-content: flex-end;
  align-items: center;
  height: 5px; /* Ajustado a 50px para que tenga espacio suficiente para contenido */
  width: calc(100% - 2rem); /* Usando 100% menos el padding para que se extienda a todo el ancho */
}
        .section-Middle{
            font-weight: bold;
            background: #cac6c6;
            color: #fff;
            padding: 10px 20px;
            margin-bottom: 10px;
        }
        .section-Left{
            font-weight: bold;
            background: linear-gradient(to right, #002aff, #b607cddc);
            color: #fff;
           padding: 7%;
           width: 100%;
           height: 1.5%;
            margin-bottom: 2%;
        }
        .section-Right{
            font-weight: bold;
            color: #fff;
            margin-right: 10%;
           
            
            
        }
        .Texto {
            font-weight: bold;
            background: white;
            color: #000000;
            margin-left: 30px;
            margin-bottom: 10px;
        }
       
        .title-amigos {
    flex-grow: 1;
    /* Esto hará que el texto ocupe el espacio disponible */
    /* Agrega cualquier estilo adicional para el texto aquí */
}
        .right-textarea {
    width: 97%;
    height: 37%;
    border: none;
    margin: 0;
}
#textarea_Recordatorios {
    background: #0ddefa;
    width: 100%;
    height: 43%;
}
#textarea_Lista_Amigos {
    background: #dd67d7;
    width: 100%;
    height: 41%;
    
}
        textarea {
            margin-left: 30px;
            width: 90%;
            height: 50%;
            background: #cac6c6;
        }
        .escuela {
            background: none;
            color: #000;
            border: none;
            padding: 10px 60px;
            margin-top: 0;
            border-radius: 0;
            cursor: pointer;
            margin-left: 2px;
        }
        .agregarSeccion {
            background: none;
            color: #000;
            border: none;
            padding: 10px 10px;
            margin-top: 350px;
            border-radius: 0;
            cursor: pointer;
            margin-left: 10px;
        }
        .save-button:hover {
            background: linear-gradient(to right, #002aff, #b607cddc);
            color: #fff;
        }
        .button-conteiner{
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 0px;
            margin-left: 220px;
        }
        
        button {
            background: none;
            color: #000;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            margin-left: 20px;
        }
        
        .button-editarSubsecciones {
            background-image: url('images/editar_texto.png');
            background-size: cover;
            background-repeat: no-repeat;
            width: 100px;
            height: 84px;
            border: none;
            cursor: pointer;
        }
       
        .button-eliminarSubseccion {
            background-image: url('images/basura.png');
            background-size: cover;
            background-repeat: no-repeat;
            width: 100px;
            height: 80px;
            border: none;
            cursor: pointer;
        }
        .button-agregar {
            background-image: url('images/Agregar_materia.PNG');
            background-size: cover;
            background-repeat: no-repeat;
            width: 100px;
            height: 80px;
            border: none;
            cursor: pointer;
        }
     
   

/* Cambiar los colores cuando se hace clic en el botón */

       
            button:hover, .Recompensa:hover, .usuarioPerfil:hover, .Configuracion:hover, 
.Seccion1:hover, .Seccion2:hover, .Campana:hover, .Agregar:hover, .AgregarAmigo:hover,
.AgregarSeccion_Mas_Left_Panel:hover,.editar_texto:hover,.eliminarSeccion:hover
,.button-left:hover,.button-middle:hover,.button-right:hover{
    background-color: rgba(226, 7, 116, 0.616); /* Color de fondo morado claro con transparencia */
    outline: 2px solid rgba(219, 12, 64, 0.5); /* Borde morado claro con transparencia */
    color: #000; /* Mantén el color del texto igual */
    transition: background-color 0.3s, outline 0.3s; /* Transición suave */
    border-radius: 10px;
}
        
        .usuarioPerfil {
            position: relative;
            display: inline-block;
         
        }
        #userMenu {
            display: none;
            position: absolute;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px;
            box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
            z-index: 1000;
            right: 0; /* Remueve esta línea si está presente */
    left: auto;
     /* Asegúrate de que el menú no sea más ancho que la ventana */
     max-width: 100%;
    overflow: hidden; /* Oculta cualquier contenido que sobrepase el menú */
    min-width: 15%; /* Ajusta esto según la anchura deseada para el menú */
    /* Otros estilos... */
        }
        #userMenu ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        #userMenu li a {
            display: block;
            color: #333;
            padding: 8px 16px;
            text-decoration: none;
        }
        #userMenu li a:hover {
            background-color: #f5f5f5;
        }
        /* ... Other styles ... */
        /* Style for the section list and add button */
        #panel-secciones {
            display: flex;
            flex-direction: column;
        }
        
        /* Ensure the add button stays at the bottom */
        #boton-agregar-seccion {
            order: 2;
            margin-top: auto;
        }

        /* Style for the editable section name */
        .editable-section-name {
            margin: 5px 0;
            padding: 10px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Hidden input for editing the section name */
        .edit-section-name {
            display: none;
            margin-bottom: 5px;
        }

        .editable-section-name.selected {
  background-color: #e0e0e0; /* Color de fondo para secciones seleccionadas */
  /* Otros estilos si es necesario */
}
.button-container {
  display: flex; /* Esto alinea horizontalmente los botones */
  flex-wrap: wrap; /* Esto permite que los botones pasen a la siguiente línea si no hay espacio */
  justify-content: flex-start; /* Alinea los botones a la izquierda */
  align-items: center; /* Centra los botones verticalmente */
  gap: 10px; /* Espacio entre los botones */
}

    .button-container2 {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 0px;
        display: flex;
        justify-content:flex-end;
        align-items: center;
        margin-right: 5%;
    }

.button-subseccion {
  background-size: cover;
  background-repeat: no-repeat;
  background-color: #504f4f;
  width: 150px;
  height: 80px;
  border: none;
  cursor: pointer;
  display: inline-flex; /* Esto permite que el contenido del botón se centre */
  justify-content: center; /* Centrar contenido horizontalmente */
  align-items: center; /* Centrar contenido verticalmente */
  text-align: center; /* Asegura que el texto también esté centrado */
  color: rgb(29, 24, 24); /* Color del texto */
  font-size: 0.8em; /* Tamaño del texto, ajustar según sea necesario */
}
.eliminar-subseccion {
    position: absolute;
    top: 0;
    right: 0;
    background-color: rgb(77, 77, 77);
    color: white;
    border: none;
    cursor: pointer;
}

    .button-guardarNota {
        background-image: url('images/guardarNota.png');
        background-size: cover;
        background-repeat: no-repeat;
        width: 50px;
        height: 50px;
        border: none;
        cursor: pointer;
    }

    .button-editarNota {
        background-image: url('images/guardarNota.png');
        background-size: cover;
        background-repeat: no-repeat;
        width: 50px;
        height: 50px;
        border: none;
        cursor: pointer;
    }
    
    .button-regresarSubseccion {
        
        background-image: url('images/FlechaIzquierda.png');
        background-size: cover;
        background-repeat: no-repeat;
        width: 80px;
        height: 40px;
        border: none;
        cursor: pointer;
                
        }


        #nombre_nota {
                width:20%; /* Ancho personalizado en píxeles */
            }



    </style>

    <!-- Agrega los archivos de flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

</head>
<body>
    <header>
        <img class="logo" src="Images/Alargado blanco.png" alt="Logo de la página">
        <a href="#" class="Recompensa"></a>
        <div class="usuarioPerfil" onclick="toggleUserMenu()">
            <!-- Icon or image for user profile -->
        </div>
        <div id="userMenu">
            <ul>
                <li><a href="informacionPerfil.html">Perfil</a></li>
                <li><a href="editarPerfil.html">Configuración de perfil</a></li>
                <li><a href="javascript:void(0);" onclick="confirmarCierreSesion()">Cerrar sesión</a></li>
            </ul>
        </div>
    </header>

    <div id="container">


        <div id="left-panel">
            <form id="panel-secciones">
                <div id="existing-sections">
                    <div id="panel-secciones" class="section-Left">Secciones</div>
                    <!-- Existing sections will be here -->
                    <!--  
                         <div class="editable-section-name" onclick="editSectionName(this)">Escuela</div>   
                    
                    <a href="#" class="editar_texto"></a>
                    <a href="#" class="eliminarSeccion"></a>*/
                    --> 
                    
                    <!-- More sections can be added dynamically here -->
                </div>
                
                <button id="boton-agregar-seccion" type ="button" class="AgregarSeccion_Mas_Left_Panel" onclick="agregarSeccion()">
                    Agregar sección
                    </button>

                    
            </form>
        </div>


        <div id="middle-panel" class="panel">
            <div id="middle-panelProgramacionWeb">
                <div class="textoPanelProgramacion">seleccione seccion.</div>
                <div class="espacio"></div>
                <a href="#" class="Configuracion"></a>
        <a href="#" class="Seccion1"></a>
        <a href="#" class="Seccion2"></a>
       


                
            </div>
            <div id="middle-panel2">
            
            <div class="button-container" data-id="{idSubseccion}">
                <!--<button class="button-redes"></button>
                <button class="button-web"></button> -->
               
                
                

              
              
            </div>
            
            </div>
            <div class="button-container2">
                <!--<button class="button-redes"></button>
                <button class="button-web"></button> -->
                
                <button class="button-agregar"></button>
                

              
              
            </div>
           
            
            
            
          
        </div>

        <!----------------------------------panel secunadario------------------------------------------->

        <div id="middle-panelSecundario" class="panel">
            <div id="middle-panelProgramacionWeb">
                <button class="button-regresarSubseccion" onclick="mostrarPanel('middle-panel')"></button>
                
                <div class="textoPanelProgramacion2">seleccione subseccion</div>
                <div class="espacio2"></div>
                <a href="#" class="Configuracion"></a>
                <a href="#" class="Seccion1"></a>
                <a href="#" class="Seccion2"></a>
       


                
            </div>
            
            
            
            
            <div class="nombreNota">
                
                <label for="nombre de nota:">Nombre:</label>
                <input type="text" id="nombre_nota" name="nombre" placeholder="Ingresar nombre de la nota" size="1%" maxlength="20%">
            

            </div>
            <label for="anotacionesNota:">Definir tarea:</label>
            <textarea id="notes"></textarea>
           
            <div class="FechaAsignacion">
                <label for="fecha">Fecha vencimiento:</label>
                <input type="text" id="fecha" name="fecha">
                
                <!-- Inicializa flatpickr para el input "fecha" -->
                <script>
                    flatpickr("#fecha", {
                        minDate: "today", // Permite seleccionar solo fechas a partir de hoy
                    });
                </script>


            </div>
            
            <label for="nombre de nota:">Comentarios adicionales:</label>
            <textarea id="comentarios"></textarea>
            <div class="button-container2">
                <button id="guardarNota" class="button-guardarNota" style="display: none;" onclick="guardarNotas()"></button>
                <button id="editarNota" class="button-editarNota" style="display: none;" onclick="EditarNota(notaId)"></button>
                

               
            </div>



        </div>
         <!----------------------------------panel secunadario------------------------------------------->

        <div id="right-panel">
            
                <div id="right-panelRecordatorios">
                    <div class="section-Right">Recordatorios</div>
                    <a href="#" class="Campana">Notificaciones</a>
                    
                    <button class="Agregar" onclick=addItem()></button>
                </div>
   

           
        
   
                <div id="checklistPanel">
                    <div id="addItemContainer">
                        <input type="text" id="newItem" placeholder="Nueva tarea">
                        
                    </div>
                
                    <ul id="checklist">
                        <!-- Aquí se agregarán dinámicamente los elementos de la lista -->
                    </ul>
                </div>

            <div id="right-panelRecordatorios">
                <div class="TextoListaAmigos">Lista de amigos</div>
                <a href="#" class="AgregarAmigo">AgregarAm</a>
                
            </div>
            <textarea id="textarea_Lista_Amigos" name="amigos" class="right-textarea"></textarea>
        </div>
    </div>
    

    <script>
// ---------------------------------------FUNCION DE LA LISTA----------------------------------------

    function addItem() {
        const newItemInput = document.getElementById("newItem");
        const newItemText = newItemInput.value.trim();

        if (newItemText !== "") {
            guardarNotas(1,newItemText);
            // Limpiar el campo de entrada
            newItemInput.value = "";

        
        }
    }

    function toggleCompleted(checkbox) {
        const listItem = checkbox.parentElement;
        listItem.classList.toggle("completed");
    }

    function deleteItem(idNota) {
        eliminarNota(idNota);
        
    }
    let notaId=null;
    function openNota(idNota) {
    // Aquí puedes agregar la lógica para abrir algo cuando se hace clic en el elemento
    notaId=idNota;
    mostrarBotonGuardarOEditar('editarNota');
    cargarNotasDetalles(idNota);
}


// ---------------------------------------FUNCION DE LA LISTA----------------------------------------

function mostrarPanel(element) {
  // Ocultar todos los paneles
  var todosLosPaneles = document.querySelectorAll('.panel');
  todosLosPaneles.forEach(function(panel) {
    panel.style.display = 'none';
  });

  // Mostrar el panel solicitado
  var panelParaMostrar = document.getElementById(element);
  if (panelParaMostrar) {
    panelParaMostrar.style.display = 'flex'; // o 'flex', 'grid', etc.
  }
}

    function mostrarBotonGuardarOEditar(element) {
    

        // Mostrar u ocultar botones según el panel
        var guardarNotaButton = document.getElementById('guardarNota');
        var editarNotaButton = document.getElementById('editarNota');

        // Verifica qué panel se está mostrando y ajusta la visibilidad de los botones
        if (element === 'guardarNota') {
            guardarNotaButton.style.display = 'block'; // o 'flex', 'grid', etc.
            editarNotaButton.style.display = 'none';
        } else if('editarNota') {
            guardarNotaButton.style.display = 'none';
            editarNotaButton.style.display = 'block'; // o 'flex', 'grid', etc.
        }
        else{
            alert('boton editar o guardar nota no agregado error');

        }
    }




function toggleUserMenu() {

            var userMenu = document.getElementById('userMenu');
            if (userMenu.style.display === 'block') {
                userMenu.style.display = 'none';
            } else {
                userMenu.style.display = 'block';
                var userProfile = document.querySelector('.usuarioPerfil');
                var rect = userProfile.getBoundingClientRect();
                userMenu.style.top = rect.bottom + 'px';
                userMenu.style.left = rect.left + 'px';
            }

            var userMenu = document.getElementById('userMenu');
    var userProfile = document.querySelector('.usuarioPerfil');
    var rect = userProfile.getBoundingClientRect();

    // Espera hasta que el menú sea visible para obtener su ancho
    userMenu.classList.toggle('user-menu-hidden');
    var menuWidth = userMenu.offsetWidth;

    // Calcular la posición izquierda
    var leftOffset = rect.right - menuWidth; // Alinea el borde derecho del menú con el borde derecho del botón

    // Asegúrate de que el menú no se sale de la pantalla a la izquierda
    leftOffset = Math.max(leftOffset, 10); // 10px de margen de la ventana izquierda

    userMenu.style.left = `${leftOffset}px`;
    userMenu.style.top = `${rect.bottom + window.scrollY}px`;
    // Si el menú ya se había ocultado, alterna la clase de nuevo
    if (userMenu.style.display === 'none') {
        userMenu.classList.toggle('user-menu-hidden');
    }

    function posicionaMenu() {
    var userMenu = document.getElementById('userMenu');
    var userProfile = document.querySelector('.usuarioPerfil');
    if (userProfile) {
        var rect = userProfile.getBoundingClientRect();
        var leftOffset = rect.left - userMenu.offsetWidth + userProfile.offsetWidth;
        // Asegúrate de que el menú no se sale de la pantalla a la izquierda
        if (leftOffset < 0) {
            leftOffset = 0; // Ajusta para que no se salga de la pantalla
        }
        userMenu.style.left = leftOffset + 'px';
        userMenu.style.top = rect.bottom + 'px';
    }
}

// Llama a posicionaMenu() cuando se carga la página y cuando se cambia el tamaño de la ventana
window.onload = posicionaMenu;
window.onresize = posicionaMenu;

// Función para alternar la visibilidad del menú
function toggleUserMenu() {
    var userMenu = document.getElementById('userMenu');
    userMenu.classList.toggle('user-menu-hidden');
    posicionaMenu(); // Asegúrate de que el menú esté correctamente posicionado
}


        }
        function cerrarSesion() {
            
        }

        function confirmarCierreSesion() {
    var confirmacion = confirm("¿Estás seguro que deseas cerrar sesión?");
    if (confirmacion) {
        // Aquí puedes añadir la lógica de cierre de sesión, como borrar cookies o tokens de sesión.
        window.location.href = 'login.html'; // Redirige a la página de inicio de sesión.
    }
}



function agregarSeccion() {
    const nombreSeccion = prompt("Nombre de la nueva sección:");
    if(nombreSeccion) {
        fetch('http://localhost:3000/crearSeccion', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ nombre: nombreSeccion, id_usuario: localStorage.getItem('userId') }) // Reemplaza 'ID_DEL_USUARIO' con el ID real del usuario
        })
        .then(response => response.json())
        .then(data => {
            if(data.message) {
                alert(data.message);
                
                const seccionesContenedor = document.getElementById('existing-sections');
                const nuevaSeccion = document.createElement('div');
                nuevaSeccion.className = 'editable-section-name';
                nuevaSeccion.textContent = nombreSeccion;
                nuevaSeccion.onclick = () => editSectionName(nuevaSeccion);
                seccionesContenedor.appendChild(nuevaSeccion);
                location.reload();
            }
        })
        .catch(error => {
            console.error('Error al crear la sección:', error);
        });
    }
}

function cargarSeccionesUsuario() {
    const idUsuario = localStorage.getItem('userId');
    if (idUsuario) {
        fetch(`http://localhost:3000/obtenerSecciones?id_usuario=${idUsuario}`)
            .then(response => response.json())
            .then(data => {
                const seccionesContenedor = document.getElementById('existing-sections');
                //seccionesContenedor.innerHTML = ''; // Limpiar el contenedor
                const juntoEdicion=document
                data.secciones.forEach(seccion => {
            
                    const seccionDiv = document.createElement('div');
                    seccionDiv.className = 'section-container';

                    const nombreSeccion = document.createElement('div');
                    nombreSeccion.className = 'editable-section-name';
                    nombreSeccion.setAttribute('data-id', seccion.id);
                    nombreSeccion.textContent = seccion.name;

                    nombreSeccion.onclick=function(){
                        setPanelText(this.textContent,seccion.id);
                        selectSection(seccion.id);
                        mostrarPanel("middle-panel");



                    }

                    
                    // Botón de editar
                    const editBtn = document.createElement('a');
                    editBtn.className = 'editar_texto';
                    editBtn.onclick = function(){
                        // Función para hacer editable el nombre de la sección
                        editSectionName(nombreSeccion);
                        
                    };

                    // Botón de eliminar
                    const deleteBtn = document.createElement('a');
                    deleteBtn.className = 'eliminarSeccion';
                    deleteBtn.onclick = function() {
                        deleteSection(seccion.id);
                    };

                            

                    seccionDiv.appendChild(nombreSeccion);
                    seccionDiv.appendChild(editBtn);
                    seccionDiv.appendChild(deleteBtn);

                    seccionesContenedor.appendChild(seccionDiv);
                });

                
            })

            .catch(error => {
                console.error('Error al cargar secciones:', error);
            });


            
    }
}



//Actualizar nombre de secciones
function updateSectionName(nombreSeccion) {
    const sectionId = nombreSeccion.getAttribute('data-id');
    const updatedName = nombreSeccion.textContent.trim();

    fetch(`http://localhost:3000/actualizarNombreSeccion`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ id: sectionId, name: updatedName })
    })
    .then(response => response.json())
    .then(data => {
        if(data.success) {
            alert('Nombre de la sección actualizado correctamente');
            location.reload();
        } else {
            alert('Error al actualizar el nombre de la sección');
        }
    })
    .catch(error => {
        console.error('Error al actualizar el nombre de la sección:', error);
    });
}

//Eliminar secciones
function deleteSection(sectionId) {
  if (confirm('¿Estás seguro de que quieres eliminar esta sección?')) {
    fetch(`http://localhost:3000/eliminarSeccion/${sectionId}`, {
      method: 'DELETE'
    })
    .then(response => response.json())
    .then(data => {
      alert(data.message); // Mensaje de éxito
      document.querySelector(`.section-container[data-id="${sectionId}"]`).remove();
     

    })
    .catch(error => {
      console.error('Error al eliminar la sección:', error);
      location.reload();
    });
  }
}





// funcion para editar las secciones
function editSectionName(nombreSeccion) {
    nombreSeccion.contentEditable = true;
    nombreSeccion.focus();
    nombreSeccion.onblur = function() {
        updateSectionName(nombreSeccion);
        
    };
}

let selectedSectionId =null;
let selectedSubSectionId =null;

function setPanelText(text, sectionId) {
  const panelTexto = document.querySelector('.textoPanelProgramacion');
  panelTexto.textContent = text;
  selectedSectionId = sectionId; // Guarda el ID de la sección seleccionada
}

function setSubPanelText(textSubseccion, SubsectionId) {
  const panelTexto2 = document.querySelector('.textoPanelProgramacion2');
  panelTexto2.textContent = textSubseccion;
  selectedSubSectionId = SubsectionId; // Guarda el ID de la sección seleccionada
}
//Subsecciones:


 //Guardar subseccion.
 

function guardarSubseccion() {
    const nombreSubseccion = prompt('Ingrese el nombre de la nueva subsección:');
  if (nombreSubseccion && selectedSectionId) { // Asegúrate de que se haya seleccionado una sección
   
    fetch('http://localhost:3000/crearSubseccion', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ nombre: nombreSubseccion, id_seccion: selectedSectionId}),
  })
  .then(response => response.json())
  .then(data => {
    console.log('Respuesta del servidor:', data); // Depurar la respuesta del servidor
    if (data.success) {
      alert('Subsección agregada con éxito.');
      // cargarSeccionesUsuario(); // Actualizar el DOM si es necesario
        cargarSubsecciones(selectedSectionId);

    } else {
      alert('Hubo un error al agregar la subsección: ' + data.message);
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Hubo un error al agregar la subsección: ' + error.message);
  });




  } else {
    alert('Primero debe seleccionar una sección.');
  }

 
}
// Función para cargar subsecciones
function cargarSubsecciones(idSeccion) {
    fetch(`http://localhost:3000/obtenerSubsecciones?id_seccion=${idSeccion}`)
        .then(response => response.json())
        .then(data => {
            const subseccionesContenedor = document.getElementById('middle-panel2');
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'button-container';
            subseccionesContenedor.innerHTML = ''; // Limpia el contenedor actual

            data.subsecciones.forEach(subseccion => {
                const button = document.createElement('button');
                button.className = `button-subseccion`;
                button.textContent = subseccion.name;
                button.id = `subseccion-${subseccion.id}`;

                // Estilos para el botón aquí...
                // Estilos para el botón
                button.style.backgroundSize = 'cover';
                button.style.backgroundRepeat = 'no-repeat';
                button.style.width = '150px';
                button.style.height = '80px';
                button.style.border = 'none';
                button.style.cursor = 'pointer';
                button.style.position = 'relative'; // Importante para el centrado del texto
                button.style.display = 'inline-block'; // Para alinear los botones horizontalmente
                button.style.marginRight = '10px'; // Espacio entre botones

                
                // Estilos para el texto del botón
                button.style.color = 'white'; // Color del texto
                button.style.textAlign = 'center'; // Centrar texto horizontalmente
                button.style.lineHeight = '80px'; // Centrar texto verticalmente
               
        
        
                //Edicion de texto
                //Edicion de texto
                button.id = `subseccion-${subseccion.id}`; // Asigna un ID único a cada botón
                let clickTimer;
                button.addEventListener('click', function() {
                    clearTimeout(clickTimer);
                    clickTimer = setTimeout(function() {
                        // Este código se ejecuta después de un solo clic (no es un doble clic)
                        mostrarPanel("middle-panelSecundario");
                        setSubPanelText(subseccion.name,subseccion.id);
                        cargarNotas(subseccion.id);
                        mostrarBotonGuardarOEditar('guardarNota');

                        
                    }, 300); // Ajusta el tiempo límite para considerar un doble clic
                });

                button.addEventListener('dblclick', function() {
                    clearTimeout(clickTimer);
                    // Este código se ejecuta cuando se hace doble clic
                    iniciarEdicionSubseccion(this, subseccion.id);

                });

                

                // Crear botón de eliminar
                const eliminarBtn = document.createElement('button');
                eliminarBtn.classList.add('eliminar-subseccion');
                eliminarBtn.textContent = 'x'; // Puede ser un ícono también
                eliminarBtn.onclick = function() {
                    confirmarYEliminarSubseccion(subseccion.id);
                };
                button.appendChild(eliminarBtn); // Agrega el botón de eliminar al botón de la subsección

                // Eventos y estilos adicionales aquí...
               


                buttonContainer.appendChild(button); // Agrega el botón al contenedor
                
            });


            

            // Agrega el botón de agregar al final
            // ...

            subseccionesContenedor.appendChild(buttonContainer);
        })
        .catch(error => {
            console.error('Error al cargar subsecciones:', error);
        });
}


// Función para confirmar y eliminar subsección
function confirmarYEliminarSubseccion(idSubseccion) {
    if (confirm('¿Está seguro de eliminar esta subsección?')) {
        fetch(`http://localhost:3000/eliminarSubseccion/${idSubseccion}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Subsección eliminada correctamente.');
                cargarSubsecciones(selectedSectionId);
               
            } else {
                alert('Error al eliminar la subsección.');
            }
        })
        .catch(error => console.error('Error:', error));
    }
}

// Asegúrate de llamar a cargarSubsecciones cuando se selecciona una sección
function selectSection(sectionId) {
    // Limpia las subsecciones antiguas
    const subseccionesContenedor = document.getElementById('middle-panel');
    // Aquí iría cualquier lógica adicional para manejar la sección seleccionada
    cargarSubsecciones(sectionId); // Carga las subsecciones correspondientes
}

//Eliminarsubseccion
// Ejemplo de cómo agregar el botón de eliminación
function agregarBotonEliminar(subseccionDiv, idSubseccion) {
    let eliminarBtn = document.createElement('button');
    eliminarBtn.textContent = 'x'; // Ajusta esto para usar un ícono o imagen
    eliminarBtn.onclick = function() {
        if (confirm('¿Está seguro de que quiere eliminar esta subsección?')) {
            eliminarSubseccion(idSubseccion);
        }
    };
    subseccionDiv.appendChild(eliminarBtn);
}

// Ejemplo de función para eliminar la subsección
function eliminarSubseccion(idSubseccion) {
    fetch(`http://localhost:3000/eliminarSubseccion/${idSubseccion}`, {
        method: 'DELETE'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Eliminar el div de la subsección del DOM
            document.querySelector(`[data-id="${idSubseccion}"]`).remove();
            alert('Subsección eliminada correctamente.');
        } else {
            alert('Error al eliminar la subsección.');
        }
    })
    .catch(error => console.error('Error:', error));
}


//Editarsubseccion
function iniciarEdicionSubseccion(button, idSubseccion) {
    let nombreActual = button.innerText;
    let input = document.createElement('input');
    input.type = 'text';
    input.value = nombreActual;
    input.onblur = function() {
        guardarNombreEditado(this.value, idSubseccion);
        button.innerText = this.value; // Actualiza el texto visualmente
    };
    button.innerText = '';
    button.appendChild(input);
    input.focus();
}

function guardarNombreEditado(nuevoNombre, idSubseccion) {
    fetch(`http://localhost:3000/actualizarSubseccion`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ id: idSubseccion, nombre: nuevoNombre }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Nombre de subsección actualizado correctamente.');
            cargarSubsecciones(selectedSectionId);
        } else {
            alert('Error al actualizar el nombre de la subsección.');
        }
    })
    .catch(error => console.error('Error:', error));
}



document.addEventListener('DOMContentLoaded', () => {
  const addButton = document.querySelector('.button-agregar');
  if (addButton) {
    addButton.addEventListener('click', guardarSubseccion);
  }
});









//Funcionalidad de notas subsecciones

// Funcionalidad de notas subsecciones
function guardarNotas(numero, valorNombre) {
    var nombreNota, nombreNotaInput, notesTextarea, fechaInput, notesTextarea2;

    if (numero === 1) {
        nombreNota = valorNombre;
    } else {
        // Obtener el elemento del campo de entrada por su ID
        nombreNotaInput = document.getElementById("nombre_nota");

        // Obtener el valor actual del campo de entrada
        nombreNota = nombreNotaInput.value;
    }

    // Obtener el elemento textarea por su ID
    notesTextarea = document.getElementById("notes");

    // Obtener el valor actual del textarea
    var valortextAreaNotes = notesTextarea.value;

    // Obtener el elemento del campo de fecha por su ID
    fechaInput = document.getElementById("fecha");

    // Obtener el valor actual del campo de fecha
    var fechaSeleccionada = fechaInput.value;

    // Obtener el elemento textarea comentarios por su ID
    notesTextarea2 = document.getElementById("comentarios");

    // Obtener el valor actual del textarea
    var textAreaComentarios = notesTextarea2.value;

    if (nombreNota && selectedSubSectionId) {
        console.log('selectedSubSectionId:', selectedSubSectionId);
        fetch('http://localhost:3000/crearNota', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                subsection_id: selectedSubSectionId,
                nombre: nombreNota,
                nota: valortextAreaNotes,
                fecha: fechaSeleccionada,
                descripcion: textAreaComentarios,
            }),
        })
            .then(response => response.json())
            .then(data => {
                console.log('Respuesta del servidor:', data);
                if (data.success) {
                    alert('Nota agregada con éxito.');
                    // Limpiar los campos
                    if (numero !== 1) {
                        nombreNotaInput.value = "";
                    }
                    notesTextarea.value = "";
                    fechaInput.value = "";
                    notesTextarea2.value = "";
                    cargarSubsecciones(selectedSectionId);
                    cargarNotas(selectedSubSectionId);
                } else {
                    alert('Hubo un error al agregar la nota: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Hubo un error al agregar la nota: ' + error.message);
            });
    } else {
        alert('Complete todos los campos y seleccione una subsección.');
    }
}

//funcion cargar notas
  // Función para cargar las notas desde la base de datos
  function cargarNotas(idSubseccion) {
            const id_seccion = selectedSubSectionId;

            

            fetch(`http://localhost:3000/obtenerNotas?id_seccion=${id_seccion}`)
                .then(response => response.json())
                .then(data => {
                    const checklist = document.getElementById("checklist");
                    checklist.innerHTML = ''; // Limpia el contenedor actual

                    // Itera sobre las notas y agrega cada una al panel de checklist
                    data.notas.forEach(nota => {
                        agregarNotaAlPanel(nota);
                        
                    });
                })
                .catch(error => {
                    console.error('Error al cargar notas:', error);
                });
        }


        function cargarNotasDetalles(idNota) {
            const id_nota = idNota;


            // Obtener el elemento del campo de entrada por su ID
            var nombreNotaInput = document.getElementById("nombre_nota");

            // Obtener el valor actual del campo de entrada
            var nombreNota = nombreNotaInput.value;

            // Obtener el elemento textarea por su ID
            var notesTextarea = document.getElementById("notes");

            // Obtener el valor actual del textarea
            var valortextAreaNotes = notesTextarea.value;

            // Obtener el elemento del campo de fecha por su ID
            var fechaInput = document.getElementById("fecha");

            // Obtener el valor actual del campo de fecha
            var fechaSeleccionada = fechaInput.value;

            // Obtener el elemento textarea comentarios por su ID
            var notesTextarea2 = document.getElementById("comentarios");

            // Obtener el valor actual del textarea
            var textAreaComentarios = notesTextarea2.value;

            fetch(`http://localhost:3000/obtenerNotasDetalles?id_nota=${id_nota}`)
            .then(response => response.json())
            .then(data => {
                // Asegúrate de que hay notas antes de iterar sobre ellas
                if (data.notas && data.notas.length > 0) {
                    nombreNotaInput.value ="";
                    notesTextarea.value = "";
                    fechaInput.value = "";
                    notesTextarea2.value ="";

                    const nota = data.notas[0]; // Solo toma la primera nota (suponiendo que solo hay una)

                    nombreNotaInput.value = nota.nombre;
                    notesTextarea.value = nota.nota;
                    fechaInput.value = nota.fecha;
                    notesTextarea2.value = nota.descripcion;
                    mostrarPanel('middle-panelSecundario');
                } else {
                    console.error('No se encontraron notas para el ID especificado.');
                }
            })
            .catch(error => {
                console.error('Error al cargar notas:', error);
            });
        }

        // Función para agregar una nota al panel de checklist
        function agregarNotaAlPanel(nota) {
            const checklist = document.getElementById("checklist");
            const nuevoItem = document.createElement("li");
            nuevoItem.innerHTML = `
                <input type="checkbox" onchange="toggleCompleted(this)">
                <span onclick="openNota(${nota.id})" class="clickable">${nota.nombre}</span>
                <button class="deleteButton" onclick="deleteItem(${nota.id})">Eliminar</button>
            `;
            checklist.appendChild(nuevoItem);
        }


        //Eliminar nota
        function eliminarNota(idNota) {
    const confirmacion = window.confirm('¿Estás seguro de que deseas eliminar esta nota?');

    if (confirmacion) {
        fetch(`http://localhost:3000/eliminarNota/${idNota}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Obtener el elemento de la nota del DOM
                alert('Nota eliminada correctamente.');
                // Verificar si el elemento existe antes de intentar eliminarlo
                cargarNotas(selectedSubSectionId);
                
            } else {
                alert('Error al eliminar la nota.');
            }
        })
        .catch(error => console.error('Error:', error));
    }
}

//Editar nota


function EditarNota(idNota) {
    alert('Estás editando con el botón editar',idNota);

    // Obtener el elemento del campo de entrada por su ID
    var nombreNotaInput = document.getElementById("nombre_nota");

    // Obtener el valor actual del campo de entrada
    var nombreNota = nombreNotaInput.value;

    // Obtener el elemento textarea por su ID
    var notesTextarea = document.getElementById("notes");

    // Obtener el valor actual del textarea
    var valortextAreaNotes = notesTextarea.value;

    // Obtener el elemento del campo de fecha por su ID
    var fechaInput = document.getElementById("fecha");

    // Obtener el valor actual del campo de fecha
    var fechaSeleccionada = fechaInput.value;

    // Obtener el elemento textarea comentarios por su ID
    var notesTextarea2 = document.getElementById("comentarios");

    // Obtener el valor actual del textarea
    var textAreaComentarios = notesTextarea2.value;

    if (nombreNota  && idNota) {
        fetch(`http://localhost:3000/EditarNota/${idNota}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                nombre: nombreNota,
                nota: valortextAreaNotes,
                fecha: fechaSeleccionada,
                descripcion: textAreaComentarios,
            }),
        })
            .then(response => response.json())
            .then(data => {
                console.log('Respuesta del servidor:', data);
                if (data.success) {
                    alert('Nota editada con éxito.');
                    // Limpiar los campos
                    nombreNotaInput.value = "";
                    notesTextarea.value = "";
                    fechaInput.value = "";
                    notesTextarea2.value = "";
                    cargarSubsecciones(selectedSectionId);
                    cargarNotas(selectedSubSectionId);
                    mostrarBotonGuardarOEditar('guardarNota');
                } else {
                    alert('Hubo un error al editar la nota: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Hubo un error al editar la nota: ' + error.message);
            });
    } else {
        alert('Complete todos los campos y seleccione una subsección.');
    }
}






document.addEventListener('DOMContentLoaded', () => {
  const addButton = document.querySelector('.button-agregar');
  if (addButton) {
    addButton.addEventListener('click', guardarSubseccion);
  }
});




      

        document.addEventListener('DOMContentLoaded', (event) => {
    cargarSeccionesUsuario();
});


   








    </script>
</body>
</html>
